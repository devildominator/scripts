#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc-script-encrypt/shc-3.8.7/shc -f gitRecurserPusherRevised.slash 
#endif

static  char data [] = 
#define      msg1_z	42
#define      msg1	((&data[7]))
	"\050\325\240\365\340\127\000\052\225\177\045\064\152\270\044\153"
	"\002\321\152\104\044\173\127\147\226\170\054\137\210\321\362\322"
	"\345\031\354\200\304\231\267\025\055\053\010\205\013\151\106\245"
	"\123\032\262"
#define      tst1_z	22
#define      tst1	((&data[53]))
	"\037\333\241\134\044\020\005\127\011\214\151\343\333\176\370\146"
	"\157\016\151\162\045\205\150\007\357\264\044"
#define      opts_z	1
#define      opts	((&data[78]))
	"\026"
#define      msg2_z	19
#define      msg2	((&data[79]))
	"\213\247\226\123\236\221\042\266\162\034\135\107\265\064\216\062"
	"\371\135\071\363\101\123\020"
#define      inlo_z	3
#define      inlo	((&data[102]))
	"\351\062\346"
#define      chk1_z	22
#define      chk1	((&data[108]))
	"\042\210\160\323\003\123\272\127\376\270\110\161\035\172\362\157"
	"\221\271\270\253\306\337\061\255\035\171\210\213"
#define      date_z	1
#define      date	((&data[133]))
	"\053"
#define      text_z	3009
#define      text	((&data[253]))
	"\265\334\360\162\363\121\033\044\077\017\145\222\037\261\374\331"
	"\062\217\152\124\027\332\315\240\146\371\251\126\277\322\042\164"
	"\257\023\347\243\144\002\307\243\022\055\066\061\336\063\013\020"
	"\302\165\145\332\120\062\172\266\053\044\015\352\367\057\137\246"
	"\102\106\111\247\111\021\113\133\076\201\214\034\265\230\055\170"
	"\015\222\122\136\304\315\024\360\362\041\333\351\121\072\220\223"
	"\200\331\072\311\352\206\045\051\007\261\105\275\111\163\065\127"
	"\006\210\265\313\126\312\273\160\220\036\165\070\000\351\174\250"
	"\122\055\301\065\255\001\110\363\320\044\263\055\353\203\023\300"
	"\243\066\201\211\322\020\001\014\076\137\254\347\221\251\174\076"
	"\037\352\032\316\311\302\144\153\155\345\201\266\260\024\147\242"
	"\224\066\264\130\073\011\367\003\301\112\045\215\260\112\321\123"
	"\137\240\300\062\141\156\011\172\335\207\050\137\106\164\062\362"
	"\235\004\112\304\106\040\144\261\335\321\052\362\063\251\132\120"
	"\065\164\044\267\063\266\375\125\323\375\232\161\101\130\304\143"
	"\037\327\260\037\051\322\217\077\002\212\233\337\342\343\013\321"
	"\261\111\337\240\031\134\132\027\014\167\147\311\212\274\340\207"
	"\225\155\246\163\170\071\035\003\227\063\016\111\053\253\100\102"
	"\103\153\327\213\057\251\032\327\132\246\277\222\134\363\107\005"
	"\073\256\360\361\131\361\166\377\313\275\040\123\360\267\126\340"
	"\276\041\165\272\223\303\257\357\017\043\335\263\155\122\277\200"
	"\210\074\343\032\242\256\316\034\206\356\361\004\003\174\254\045"
	"\020\275\352\316\151\007\014\004\343\100\272\306\172\106\014\254"
	"\136\123\005\226\207\123\077\205\326\257\016\276\232\234\342\313"
	"\164\300\331\171\162\066\111\372\074\250\043\237\202\021\365\327"
	"\035\332\361\052\217\141\114\331\075\141\025\167\243\117\376\141"
	"\320\202\030\376\067\377\077\252\332\205\261\250\313\264\326\047"
	"\354\136\321\313\252\147\325\323\354\060\352\104\176\137\137\362"
	"\030\060\147\031\044\327\145\021\160\036\335\074\203\361\043\324"
	"\343\011\354\336\207\310\112\140\072\171\256\362\356\000\051\212"
	"\060\333\067\260\204\326\011\071\205\023\242\021\171\142\312\052"
	"\104\331\337\365\030\356\372\361\272\030\234\344\065\266\142\174"
	"\210\135\020\164\161\214\071\355\375\222\140\076\160\312\331\117"
	"\374\222\226\165\246\277\315\361\336\365\213\367\262\122\124\221"
	"\220\305\260\237\015\365\236\060\307\066\157\050\253\132\262\067"
	"\153\212\323\121\175\060\232\054\042\164\241\001\301\372\177\145"
	"\064\136\071\122\205\061\321\350\007\075\231\256\377\240\165\102"
	"\114\166\020\232\331\235\240\373\232\252\153\367\103\014\111\203"
	"\101\016\117\055\225\053\241\077\145\134\012\146\070\315\106\004"
	"\256\000\371\070\145\302\363\174\333\335\365\025\223\217\225\217"
	"\202\145\174\201\151\246\357\342\045\016\104\256\255\345\061\173"
	"\163\252\360\126\032\105\010\303\050\075\373\304\040\317\207\321"
	"\143\053\135\033\147\323\377\121\374\045\153\236\112\155\012\060"
	"\367\246\111\252\000\260\350\172\021\147\020\114\336\137\361\246"
	"\324\132\360\061\377\114\372\352\073\157\151\301\364\177\003\355"
	"\365\201\346\350\257\107\272\026\107\051\244\220\215\220\044\324"
	"\156\005\157\015\032\166\330\253\326\015\301\353\176\064\305\222"
	"\325\066\206\172\267\251\306\005\227\352\043\106\322\173\024\062"
	"\041\212\320\151\026\043\370\173\260\314\057\152\276\102\063\330"
	"\027\001\257\263\221\101\146\161\205\243\006\163\165\170\072\330"
	"\015\232\006\254\254\056\264\366\103\317\332\335\050\246\312\162"
	"\175\010\007\153\027\220\307\224\234\034\375\164\224\350\073\261"
	"\133\130\261\054\042\262\103\357\242\057\203\161\154\316\134\050"
	"\345\000\141\105\052\174\103\140\075\225\223\017\012\171\337\033"
	"\131\224\253\213\217\332\132\142\366\157\042\071\233\253\361\205"
	"\100\333\270\157\052\250\340\350\016\142\050\332\177\106\153\221"
	"\054\275\103\204\001\231\321\263\351\034\020\054\217\133\041\060"
	"\210\361\151\055\377\007\017\156\050\240\141\046\147\204\223\003"
	"\055\036\006\260\005\201\132\240\340\252\375\051\352\227\217\304"
	"\063\044\007\312\135\061\267\047\262\211\347\355\246\134\377\101"
	"\214\245\054\062\074\257\010\225\064\373\255\064\221\354\274\174"
	"\100\231\364\246\127\077\062\250\154\232\106\360\152\121\345\345"
	"\111\322\375\167\064\217\161\203\101\240\373\261\223\111\267\205"
	"\077\057\164\337\264\226\065\327\327\004\337\352\062\053\123\316"
	"\376\242\210\155\137\155\232\337\230\162\064\361\137\062\211\102"
	"\113\313\204\274\307\263\174\276\236\326\323\325\172\314\276\231"
	"\370\200\024\341\125\226\344\120\015\311\173\045\110\110\315\177"
	"\244\071\076\331\151\165\333\156\175\211\062\215\213\064\375\010"
	"\075\077\362\176\053\375\203\362\004\311\346\176\221\065\201\110"
	"\043\070\337\323\063\007\143\040\352\002\043\200\066\174\053\073"
	"\107\210\223\246\172\154\342\363\367\131\246\300\332\304\153\121"
	"\327\025\034\211\167\136\012\372\213\214\240\351\223\153\127\257"
	"\315\277\351\033\144\116\275\171\000\335\003\100\256\045\275\260"
	"\035\262\304\065\116\223\113\123\111\316\127\343\264\244\330\333"
	"\106\001\317\334\076\003\144\143\302\320\342\101\222\026\112\332"
	"\062\136\132\156\307\274\354\334\101\063\314\174\122\156\270\050"
	"\327\076\372\171\366\032\021\346\354\271\007\155\074\161\271\151"
	"\342\140\124\010\216\267\321\045\072\250\226\063\126\042\234\314"
	"\136\211\131\324\302\050\302\354\233\177\225\254\132\065\155\135"
	"\232\127\120\116\233\051\323\361\143\051\105\121\366\351\215\320"
	"\145\030\301\242\032\002\017\361\130\067\374\127\236\160\211\356"
	"\231\316\332\060\144\112\325\373\306\034\015\005\060\166\302\276"
	"\307\263\326\042\125\332\330\061\223\325\062\132\206\301\303\300"
	"\106\114\077\334\110\065\204\060\251\344\216\176\346\105\373\103"
	"\333\267\321\152\307\314\154\206\300\337\233\021\344\167\103\272"
	"\077\361\314\044\372\006\103\021\141\347\005\356\152\252\024\003"
	"\011\075\021\112\321\003\346\333\350\072\203\226\065\342\041\075"
	"\114\062\337\136\127\244\245\372\307\214\171\042\355\120\157\242"
	"\232\362\241\064\367\354\065\347\154\150\035\260\060\200\102\222"
	"\262\060\231\262\271\146\250\103\177\367\360\010\374\345\217\364"
	"\357\001\373\151\363\323\120\024\041\271\340\217\212\127\027\044"
	"\243\321\305\234\264\106\255\313\072\142\115\375\244\152\001\001"
	"\005\270\247\152\023\356\026\113\273\112\106\010\274\214\201\133"
	"\352\256\044\236\034\120\206\104\310\252\031\262\063\223\263\036"
	"\106\071\031\155\202\155\123\104\205\105\276\243\004\375\050\244"
	"\377\110\064\361\203\317\173\241\124\221\322\320\104\335\276\125"
	"\227\050\037\052\012\060\007\375\315\257\260\205\042\312\355\004"
	"\056\265\130\254\250\113\060\131\025\040\376\350\045\136\153\255"
	"\030\317\071\132\010\153\263\261\031\320\317\220\170\022\276\363"
	"\062\274\337\037\124\300\251\160\257\131\141\310\330\110\074\325"
	"\064\015\151\177\376\145\357\063\055\306\003\277\317\367\315\072"
	"\315\014\004\033\017\253\345\276\370\030\041\166\337\206\134\257"
	"\125\100\265\167\353\271\141\000\036\053\104\226\361\364\020\071"
	"\254\357\033\270\142\043\302\151\106\152\240\153\017\162\276\140"
	"\324\205\334\367\124\261\162\133\371\237\270\171\057\344\340\311"
	"\050\270\053\344\302\076\161\323\016\236\115\152\013\241\107\221"
	"\012\155\322\115\304\021\311\123\353\156\320\122\261\262\344\140"
	"\070\040\246\306\206\252\174\120\343\042\171\330\124\025\332\000"
	"\164\216\312\356\036\331\051\153\227\002\252\367\310\171\332\115"
	"\230\230\372\070\325\023\266\261\217\047\015\177\255\226\367\122"
	"\162\236\166\347\241\053\275\241\367\333\247\054\164\267\245\075"
	"\311\362\232\147\007\344\004\022\016\257\123\006\171\210\037\051"
	"\025\233\316\066\010\230\255\035\057\040\320\336\174\333\142\311"
	"\133\177\165\300\046\101\130\143\226\041\073\177\245\234\344\025"
	"\330\007\221\103\365\015\221\007\373\016\103\350\065\312\362\322"
	"\053\067\012\143\045\206\333\115\222\147\041\134\272\317\217\343"
	"\140\116\170\347\315\214\037\154\111\323\130\155\001\324\005\151"
	"\031\232\130\246\222\310\033\322\076\273\075\255\352\060\327\371"
	"\206\337\375\140\276\256\121\344\350\142\052\352\213\156\003\131"
	"\013\151\077\113\072\263\151\325\132\020\045\224\207\340\111\340"
	"\105\342\162\031\114\300\122\051\030\071\170\052\023\073\161\017"
	"\201\374\233\275\124\302\357\215\306\346\022\076\216\330\255\034"
	"\305\144\354\274\226\360\214\272\214\373\310\154\121\034\077\347"
	"\267\153\333\035\227\335\210\153\314\076\342\031\225\057\235\132"
	"\047\303\314\211\200\320\043\032\240\061\037\374\007\202\343\013"
	"\372\127\061\363\301\240\133\353\215\372\363\323\104\176\256\105"
	"\040\007\047\056\167\351\042\214\377\011\112\263\260\140\353\174"
	"\223\114\014\071\106\025\173\114\367\022\332\367\133\200\020\004"
	"\060\362\242\274\111\367\320\162\312\071\033\241\354\154\344\237"
	"\002\367\315\021\325\233\010\214\171\233\020\326\033\221\366\152"
	"\070\101\373\201\051\052\377\162\350\354\044\304\064\211\315\335"
	"\335\003\115\116\273\344\065\017\205\107\264\372\343\140\310\314"
	"\217\356\173\356\375\023\353\103\105\020\366\065\104\260\135\334"
	"\256\015\227\235\336\127\364\241\211\140\167\153\167\021\202\224"
	"\162\026\323\263\350\252\275\227\210\113\032\335\316\207\113\177"
	"\360\240\363\171\354\311\303\240\256\354\073\207\045\357\341\107"
	"\130\236\026\074\104\166\342\364\341\071\220\356\052\256\324\206"
	"\041\164\072\365\055\311\132\231\061\312\340\067\046\257\135\162"
	"\164\315\307\001\031\316\352\000\070\314\240\031\107\143\173\335"
	"\153\145\171\374\252\103\273\022\155\221\376\037\363\137\322\131"
	"\002\310\212\137\145\017\051\246\300\006\167\347\363\051\320\134"
	"\066\241\325\365\373\206\166\223\107\101\005\030\140\273\024\056"
	"\203\170\234\136\212\323\156\102\016\033\314\243\040\073\165\335"
	"\021\142\224\225\256\124\156\251\135\134\354\160\056\057\214\141"
	"\253\217\042\342\203\301\160\314\160\031\376\077\244\371\017\107"
	"\056\072\362\107\230\121\306\134\176\365\003\260\031\057\220\161"
	"\165\151\145\004\337\114\204\274\356\213\343\307\221\040\222\375"
	"\355\104\203\247\055\205\126\277\071\346\313\000\256\002\364\163"
	"\071\014\123\177\121\242\051\343\112\317\152\141\374\313\073\226"
	"\370\233\043\251\263\104\132\353\106\112\022\372\146\241\116\375"
	"\213\214\350\242\031\127\133\067\255\075\267\046\214\270\225\216"
	"\351\136\052\207\210\073\165\271\132\136\177\240\200\145\353\076"
	"\251\045\060\266\306\307\334\062\203\261\314\045\317\022\141\320"
	"\107\142\371\164\324\046\262\057\150\254\030\164\061\162\067\062"
	"\113\040\370\061\012\343\114\364\242\057\043\204\146\330\110\345"
	"\052\157\273\032\100\115\257\346\314\024\317\132\274\306\165\113"
	"\116\127\336\166\200\202\213\153\030\245\267\230\221\011\275\101"
	"\346\032\032\007\256\333\051\174\257\045\004\371\062\022\200\156"
	"\227\244\124\344\351\362\040\040\364\251\052\003\313\206\054\151"
	"\116\336\104\015\110\005\127\056\146\310\222\105\221\314\113\247"
	"\346\032\306\037\360\121\035\001\025\312\365\014\171\177\203\037"
	"\234\266\163\211\172\011\175\306\260\266\261\156\351\345\165\344"
	"\352\203\013\130\076\204\326\244\377\031\336\373\255\200\061\045"
	"\242\310\072\311\270\216\036\105\100\374\047\137\313\244\126\375"
	"\142\047\040\072\266\153\305\260\010\077\027\162\171\066\116\154"
	"\310\066\242\331\324\374\346\367\327\354\017\125\235\254\176\156"
	"\037\322\026\217\015\221\154\200\076\052\376\363\155\006\204\324"
	"\135\253\030\132\352\177\101\242\025\014\305\302\330\027\262\202"
	"\047\264\153\346\172\244\233\125\074\162\207\066\105\132\140\001"
	"\307\272\243\144\165\242\263\057\375\345\270\310\171\204\131\034"
	"\247\061\270\016\076\164\034\253\122\050\135\261\340\003\302\246"
	"\370\010\244\171\125\163\266\302\262\124\346\120\237\154\152\137"
	"\302\003\350\371\161\006\057\211\107\242\052\007\160\212\224\377"
	"\215\066\170\071\362\303\355\024\235\370\371\267\106\051\212\002"
	"\364\213\004\360\002\247\171\334\065\271\040\331\011\027\264\214"
	"\046\031\251\022\221\040\253\034\236\317\114\075\216\243\360\002"
	"\012\322\246\230\227\115\341\274\164\360\200\323\323\163\111\073"
	"\161\265\324\170\032\322\312\230\345\111\217\373\202\242\242\154"
	"\055\325\206\043\001\234\171\050\004\277\321\053\201\074\131\045"
	"\340\032\015\020\162\167\017\050\270\377\346\267\330\004\206\133"
	"\074\020\212\255\374\206\106\267\022\161\116\307\066\302\150\225"
	"\144\376\224\334\167\224\232\222\267\235\301\234\132\203\350\336"
	"\300\257\214\256\324\044\134\243\023\310\344\233\046\051\256\332"
	"\066\200\340\067\065\243\016\335\203\354\244\256\135\304\207\024"
	"\073\131\345\350\045\021\304\366\310\176\154\136\101\347\363\074"
	"\354\010\050\111\264\177\355\333\265\126\067\117\332\104\216\166"
	"\114\102\227\256\364\357\307\004\352\311\120\226\220\245\244\112"
	"\206\231\357\230\270\166\005\160\136\177\067\242\331\306\327\030"
	"\376\373\174\004\022\364\373\073\147\362\167\262\342\023\375\231"
	"\241\236\311\275\341\160\140\164\275\240\305\304\242\123\017\035"
	"\325\105\154\247\254\114\060\315\050\302\255\237\357\345\025\131"
	"\102\126\344\261\174\334\344\177\336\146\043\021\322\275\252\156"
	"\002\365\363\361\237\051\040\242\335\217\207\235\065\173\111\215"
	"\015\165\246\263\326\113\315\152\351\053\220\265\371\334\042\361"
	"\026\320\154\114\257\147\045\205\161\360\132\075\112\221\176\213"
	"\007\211\147\021\325\061\260\350\111\354\226\062\075\320\302\321"
	"\121\234\014\033\206\222\100\257\232\361\365\127\073\151\215\223"
	"\157\025\111\072\154\023\365\265\377\214\350\075\135\252\016\256"
	"\107\033\311\316\255\011\176\107\373\163\237\067\335\054\312\114"
	"\102\023\206\256\046\174\144\046\010\114\144\145\367\162\024\076"
	"\215\335\014\073\347\212\203\342\376\042\031\333\117\344\047\221"
	"\370\256\100\037\052\244\105\063\361\251\231\350\034\255\047\252"
	"\213\064\345\162\276\150\125\275\213\157\230\332\123\300\153\114"
	"\156\254\153\231\121\260\314\102\132\146\053\167\024\123\041\237"
	"\207\007\022\106\157\150\003\373\327\234\325\053\135\100\167\314"
	"\355\342\145\076\223\062\201\356\231\254\145\255\377\207\114\207"
	"\216\137\315\376\307\321\371\237\156\316\312\313\017\102\227\374"
	"\045\375\072\271\057\273\247\310\150\015\166\150\224\302\357\042"
	"\042\275\041\351\216\032\211\374\351\123\310\370\226\137\365\274"
	"\134\057\165\214\353\034\125\123\052\313\273\276\216\253\341\261"
	"\150\003\232\367\035\044\364\007\170\274\000\016\033\365\312\170"
	"\045\100\005\020\134\132\144\207\046\040\105\265\313\047\146\064"
	"\052\001\054\110\045\040\117\235\335\120\254\370\105\166\161\152"
	"\266\166\172\023\321\337\233\367\377\340\255\313\010\023\000\062"
	"\024\054\173\071\115\313\327\052\033\203\043\140\372\224\313\260"
	"\013\106\304\334\045\137\324\044\100\202\360\110\225\360\173\252"
	"\034\366\343\151\301\273\223\335\076\266\075\070\113\010\351\126"
	"\116\256\063\164\015\010\230\116\212\211\227\040\171\023\312\226"
	"\012\256\377\314\151\223\251\247\112\346\337\225\357\311\354\076"
	"\167\040\262\205\051\113\323\263\324\153\323\115\176\236\343\210"
	"\114\343\125\265\167\376\135\301\345\075\127\324\006\104\023\175"
	"\144\305\002\215\021\326\101\345\102\025\063\300\263\027\111\377"
	"\373\236\265\162\235\022\064\202\117\214\127\125\320\152\323\065"
	"\060\325\303\101\254\004\047\356\031\132\257\315\161\371\315\154"
	"\230\202\337\065\224\023\267\343\240\017\071\160\172\014\246\252"
	"\342\151\354\216\155\023\175\207\155\055\125\337\046\042\114\276"
	"\244\054\363\071\100\253\034\340\273\125\121\065\142\367\337\104"
	"\140\314\322\316\337\120\126\115\175\253\055\243\316\172\142\162"
	"\246\126\254\346\002\310\306\275\036\027\362\200\016\322\305\157"
	"\236\227\076\175\350\225\313\145\101\371\010\017\163\153\202\031"
	"\301\056\377\303\367\305\200\026\335\162\227\354\105\134\133\343"
	"\364\232\141\334\057\054\101\160\045\112\200\231\265\002\262\167"
	"\061\261\072\050\167\273\076\124\056\325\100\163\061\234\126"
#define      shll_z	10
#define      shll	((&data[3861]))
	"\210\066\122\060\351\104\116\374\116\275\002\146"
#define      tst2_z	19
#define      tst2	((&data[3874]))
	"\013\353\244\307\213\164\032\326\244\162\207\034\116\133\002\274"
	"\060\036\337\271\216\127\244\104"
#define      xecc_z	15
#define      xecc	((&data[3898]))
	"\213\376\217\265\365\022\020\102\132\170\014\013\376\175\347\150"
	"\007\367"
#define      rlax_z	1
#define      rlax	((&data[3915]))
	"\101"
#define      chk2_z	19
#define      chk2	((&data[3920]))
	"\307\023\124\371\173\330\142\300\246\047\074\116\137\261\266\303"
	"\001\312\073\375\160\012\015\257\253\037\346"
#define      lsto_z	1
#define      lsto	((&data[3943]))
	"\116"
#define      pswd_z	256
#define      pswd	((&data[3969]))
	"\124\365\173\370\072\325\116\366\140\126\356\024\325\240\006\250"
	"\202\316\273\327\310\153\203\347\122\031\001\201\152\243\037\077"
	"\043\172\022\010\041\020\243\312\162\207\252\021\210\053\214\355"
	"\175\077\311\357\056\022\046\226\053\047\027\226\313\067\325\356"
	"\261\350\366\322\371\232\235\153\042\107\174\252\163\010\227\361"
	"\110\140\340\166\163\007\014\237\057\044\066\372\133\014\350\015"
	"\365\336\337\356\171\174\131\233\304\326\105\067\336\335\050\046"
	"\075\010\235\261\017\252\121\077\316\207\071\052\223\041\067\211"
	"\000\027\167\171\224\320\024\130\246\132\217\205\067\267\254\165"
	"\300\111\046\320\363\167\017\302\377\110\354\223\152\044\034\152"
	"\073\223\343\317\144\370\047\013\122\267\221\211\157\075\376\057"
	"\207\045\000\173\234\017\075\234\130\052\057\302\116\113\055\212"
	"\337\020\131\103\011\201\117\133\071\340\345\250\035\343\327\245"
	"\010\330\040\245\350\136\102\100\210\161\003\327\275\060\141\234"
	"\101\273\340\112\075\057\245\166\017\213\036\055\156\366\322\167"
	"\316\362\035\266\120\137\366\331\321\372\260\216\052\022\052\153"
	"\315\013\266\012\072\133\200\111\346\236\167\125\224\111\315\143"
	"\073\353\031\214\113\020\145\034\012\347\012\237\060\160\303\204"
	"\145\077"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
